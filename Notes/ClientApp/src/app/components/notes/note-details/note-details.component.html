<div *ngIf="note; else noteNotSelected">
    <div *ngIf="!note.noteId || noteService.noteMode===mode.edit">
        <form [formGroup]="noteForm" (ngSubmit)="onSubmit()">
            <div class="row m-1">
                <div class="col">
                    <div *ngIf="responseMessage && responseMessage.message" class="row align-items-center m-2">
                        <div [className]="'alert alert-'+responseMessage.type">
                            <div>{{responseMessage.message}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row m-1 align-items-center">
                <div class="col-3 fw-bold">
                    Description
                </div>
                <div class="col-9">
                    <input type="text" id="description"
                        autocomplete="off" spellcheck="false"
                         formControlName="description" class="form-control"
                        (focus)="showDescriptionErrors=false" 
                        (blur)="showDescriptionErrors=true" />
                    <div *ngIf="
                            showDescriptionErrors 
                            && noteForm.get('description')!.touched
                            && !noteForm.get('description')!.valid
                             ">
                        <span *ngIf="noteForm.get('description')!.errors!.required" class="text-danger">
                            Description is required.
                        </span>
                        <span class="text-danger" *ngIf="noteForm.get('description')!.errors!.pattern">
                            Only alphanumeric characters allowed.
                        </span>
                        <span class="text-danger" *ngIf="
                                noteForm.get('description')!.errors!.maxlength
                                || noteForm.get('description')!.errors!.minlength">
                            Description min length of 3 and max length of 20
                        </span>
                    </div>
                </div>
            </div>
            <div class="row mt-4 mx-1 my-1">
                <div class="col">
                    <div class="row">
                        <div class="col-6 text-start">
                            <label for="body">Body</label>
                        </div>
                        <div [className]="'col-6 text-end '+(remainingBodylength>textareaMaxlength/10?'text-success':(remainingBodylength>0?'text-warning':'text-danger'))">
                            {{remainingBodylength}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-1 mx-1 my-1">
                <div class="col">
                    <textarea 
                    spellcheck="false"
                    class="form-control" 
                    formControlName="body" 
                    style="height: 15em;"
                        (focus)="showBodyErrors=false" (blur)="showBodyErrors=true" 
                        (keyup)="bodyChangeEvent($event)"
                        >
                    </textarea>
                    <div
                        *ngIf="showBodyErrors && noteForm.get('body')!.touched && !noteForm.get('body')!.valid">
                        <span class="text-danger" *ngIf="noteForm.get('body')!.errors!.required">
                            Body is required.
                        </span>
                        <span class="text-danger" *ngIf="noteForm.get('body')!.errors!.minlength">
                            Body is of min length 10.
                        </span>
                        <span class="text-danger" *ngIf="noteForm.get('body')!.errors!.maxlength">
                            Body is of max length {{textareaMaxlength}} only.
                        </span>
                    </div>
                </div>
            </div>
            <div class="row mx-1 my-1 mt-2">
                <div class="col-2">
                    <label>Tags</label>
                </div>
                <div class="col-8">
                    <div class="row">
                        <div class="col">
                            <button
                                type="button"
                                *ngFor="let tag of availableTags"
                                [className]="'m-2 btn '+(selectedTags.includes(tag.tagId)?'btn-outline-success':'btn-outline-warning')"
                                (click)="updateTagSelection(tag)"
                                >
                                {{tag.tagName}}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mx-1 my-1 mt-3">
                <div class="col">
                    <button class="btn btn-outline-danger">
                        {{ note!.noteId?"Update":"Add" }}
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div *ngIf="noteService.noteMode===mode.view">
        <div class="row mt-3 m-1 align-items-center">
            <div class="col-3 fw-bold text-warning">
                Description
            </div>
            <div class="col-9">
                {{note.description}}
            </div>
        </div>
        <div class="row mt-3 m-1">
            <div class="col-12 fw-bold text-warning">
                Body
            </div>
            <div class="col">
                {{note.body}}
            </div>
        </div>
        <div class="row mt-3 m-1">
            <div class="col-12 fw-bold text-warning">
                Tags
            </div>
            <div class="col">
                <button
                type="button"
                *ngFor="let noteTag of note!.noteTags"
                class="m-2 btn btn-outline-success"
                >
                {{noteTag.tag.tagName}}
            </button>
            </div>
        </div>
    </div>
</div>
<ng-template #noteNotSelected>
    Select a note to show the content.
</ng-template>
